!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.CanvasVideo=e()}}(function(){var e,t,n;return function i(e,t,n){function o(a,s){if(!t[a]){if(!e[a]){var u=typeof require=="function"&&require;if(!s&&u)return u(a,!0);if(r)return r(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var p=t[a]={exports:{}};e[a][0].call(p.exports,function(t){var n=e[a][1][t];return o(n?n:t)},p,p.exports,i,e,t,n)}return t[a].exports}var r=typeof require=="function"&&require;for(var a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,n){"use strict";var i={uid:function(){var e=(new Date).getTime();var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+Math.random()*16)%16|0;e=Math.floor(e/16);return(t=="x"?n:n&3|8).toString(16)});return t},removeVideoElement:function(e){var t;if(e===null){return false}t=e.querySelectorAll("source");for(var n=t.length-1;n>=0;n--){e.removeChild(t[n])}e.src="";e.removeAttribute("src");if(e.load instanceof Function){e.load()}if(e.parentNode instanceof HTMLElement){e.parentNode.removeChild(e)}return e},getExtension:function(e){var t=/[.]/.exec(e)?/[^.]+$/.exec(e)[0]:undefined;if(t)t=t.substring(0,3);return t},getAudioSupport:function(e){var t=new Audio;if(!e){var n={mp3:!!t.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")};return n}else{return!!t.canPlayType(e).replace(/^no$/,"")}},isIOSdevice:/iPhone|iPad|iPod/i.test(navigator.userAgent)?true:false};t.exports=i},{}],2:[function(e,t,n){"use strict";var i={ENDED:"ended",LOAD_START:"loadstart",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",PLAYING:"playing",PROGRESS:"progress",TIME_UPDATE:"timeupdate",WAITING:"waiting"};t.exports=i},{}],3:[function(e,t,n){"use strict";function i(e,t){this.type=e;if(t===undefined)t={};this.datas=t;this.timeStamp=Number(new Date)}i.prototype.constructor=i;t.exports=i},{}],4:[function(e,t,n){"use strict";var i=function(){};i.prototype={constructor:i,apply:function(e){e.addEventListener=i.prototype.addEventListener;e.hasEventListener=i.prototype.hasEventListener;e.removeEventListener=i.prototype.removeEventListener;e.dispatchEvent=i.prototype.dispatchEvent},addEventListener:function(e,t){if(this._listeners===undefined)this._listeners={};var n=this._listeners;if(n[e]===undefined){n[e]=[]}if(n[e].indexOf(t)===-1){n[e].push(t)}},hasEventListener:function(e,t){if(this._listeners===undefined)return false;var n=this._listeners;if(n[e]!==undefined&&n[e].indexOf(t)!==-1){return true}return false},removeEventListener:function(e,t){if(this._listeners===undefined)return;var n=this._listeners;var i=n[e];if(i!==undefined){var o=i.indexOf(t);if(o!==-1){i.splice(o,1)}}},dispatchEvent:function(e){if(this._listeners===undefined)return;var t=this._listeners;var n=t[e.type];if(n!==undefined){e.target=this;var i=[];var o=n.length;for(var r=0;r<o;r++){i[r]=n[r]}for(var r=0;r<o;r++){i[r].call(this,e)}}},bubble:function(e){this.dispatchEvent(e)}};t.exports=i},{}],5:[function(e,t,n){"use strict";e("howler");var i=e("../event/EventDispatcher");var o=e("../event/Event");var r=e("../event/CanvasVideoEvent");function a(e,t){i.call(this);var n=this;var a;this.options={loop:false};function s(e,t){for(var i in t){n.options[i]=t[i]}a=new Howl({urls:[e],format:"mp4",onload:u,loop:n.options.loop,volume:n.options.volume,onend:function(e){n.dispatchEvent(new o(r.ENDED))}}).load()}this.play=function(){a.play()};this.pause=function(){a.pause()};this.destroy=function(){a.unload()};Object.defineProperty(n,"loop",{get:function(){return n.options.loop},set:function(e){n.options.loop=e;a.loop=e}});Object.defineProperty(n,"currentTime",{get:function(){return a?a.pos():0},set:function(e){a.pos(e)}});Object.defineProperty(n,"volume",{get:function(){return a?a.volume:1},set:function(e){n.options.volume=e;a.volume(e)}});function u(e){n.dispatchEvent(new o(r.CAN_PLAY,{}))}s(e,t)}a.prototype=Object.create(i.prototype);a.prototype.constructor=a;t.exports=a},{"../event/CanvasVideoEvent":2,"../event/Event":3,"../event/EventDispatcher":4,howler:7}],6:[function(e,t,n){"use strict";var i=e("../event/EventDispatcher"),o=e("../event/Event"),r=e("../core/Utils"),a=e("./AudioPlayer"),s=e("../event/CanvasVideoEvent");function u(e,t){i.call(this);var n=this;var u,c,p;var f=false,d=false,l=false,v=false;var m,y,h;var g=0,E;var x=false;var b=false;this.options={fps:24,loop:true,hideVideoElement:true,xhr:false,autoplay:false,volume:1,playbackRate:1};this.src=e;function T(e,t){E=r.isIOSdevice;for(var i in t){n.options[i]=t[i]}if(n.options.audio&&!t.fps)n.options.fps=45;n.element=document.createElement("canvas");n.ctx=n.element.getContext("2d");if(n.options.width)n.element.width=n.options.width;if(n.options.height)n.element.height=n.options.height;if(n.options.preload===true||n.options.autoplay===true)n.load()}this.load=function(){if(!x){if(n.options.xhr){L(e)}else{O(e)}}};this.play=function(){if(x&&l){v=true;m=Date.now();if(p){m=p.currentTime;p.play()}P();w();n.dispatchEvent(new o("play"))}else{n.options.autoplay=true;if(!x)this.load()}};this.pause=function(){v=false;n.dispatchEvent(new o("pause"));if(p){p.pause()}};this.destroy=function(){v=false;if(p){p.destroy();p=null}r.removeVideoElement(c);C();c=null};this.canPlayType=function(e){var t;if(c)t=c;else t=document.createElement("video");return t.canPlayType(e)};Object.defineProperty(n,"width",{get:function(){return n.element.width},set:function(e){n.options.width=e;n.element.width=e;c.width=e}});Object.defineProperty(n,"height",{get:function(){return n.element.height},set:function(e){n.options.height=e;n.element.height=e;c.height=e}});Object.defineProperty(n,"videoWidth",{get:function(){return c.videoWidth}});Object.defineProperty(n,"videoHeight",{get:function(){return c.videoHeight}});Object.defineProperty(n,"fps",{get:function(){return n.options.fps},set:function(e){if(n.options.audio)n.options.fps=e}});Object.defineProperty(n,"loop",{get:function(){return n.options.loop},set:function(e){n.options.loop=e}});Object.defineProperty(n,"volume",{get:function(){return n.options.volume},set:function(e){n.options.volume=e;if(p)p.volume=e}});Object.defineProperty(n,"muted",{get:function(){if(!p||p.volume!=0)return false;else return true},set:function(e){if(e){if(p)p.volume=0}else{if(p)p.volume=n.options.volume}}});Object.defineProperty(n,"needTouchDevice",{get:function(){return E}});Object.defineProperty(n,"currentTime",{get:function(){return g},set:function(e){b=true;if(p){v=true;p.currentTime=e;c.currentTime=e;m=p.currentTime}else{c.currentTime=e}}});Object.defineProperty(n,"duration",{get:function(){if(c)return c.duration;else return NaN}});Object.defineProperty(n,"seeking",{get:function(){return b}});Object.defineProperty(n,"playbackRate",{get:function(){return n.options.playbackRate},set:function(e){n.options.playbackRate=e;if(n.options.audio){if(p)p.playbackRate=e}}});Object.defineProperty(n,"readyState",{get:function(){return l?4:0}});Object.defineProperty(n,"controls",{get:function(){console.warn("controls attribute is not currently supported by CanvasVideo.")},set:function(e){console.warn("controls attribute is not currently supported by CanvasVideo.")}});Object.defineProperty(n,"autoplay",{get:function(){return n.options.autoplay},set:function(e){n.options.autoplay=true}});function w(){if(v){if(n.options.audio){var e=p.currentTime;var t=e-m}else{var e=Date.now();var t=(e-m)/1e3}if(t>=1e3/n.options.fps/1e3){if(!n.options.audio){c.currentTime=c.currentTime+t*n.options.playbackRate;m=e}else{c.currentTime=c.currentTime+t;m=c.currentTime}}g=Math.round(parseFloat(c.currentTime)*1e4)/1e4;var i=Math.round(parseFloat(c.duration)*1e4)/1e4;if(g>=i){if(!n.options.audio)n.dispatchEvent(new o(s.ENDED));if(n.options.loop){if(!n.options.audio){c.currentTime=0}}else{v=false;n.currentTime=0;return}}requestAnimationFrame(w)}}function P(){n.ctx.drawImage(c,0,0,c.width,c.height);n.dispatchEvent(new o("timeupdate"));if(b){n.dispatchEvent(new o(s.CAN_PLAY_THROUGH));n.dispatchEvent(new o(s.CAN_PLAY));b=false}}function A(){l=true;if(!n.options.width)n.element.width=c.videoWidth;if(!n.options.height)n.element.height=c.videoHeight;c.width=n.element.width;c.height=n.element.height;n.dispatchEvent(new o(s.CAN_PLAY_THROUGH));n.dispatchEvent(new o(s.CAN_PLAY));if(n.options.autoplay)n.play()}function O(e){x=true;c=D(e);j();if(!n.options.id)n.id=c.id?c.id:r.uid();else n.id=n.options.id;c.id=n.id;setTimeout(function(){c.load()},50);if(n.options.audio){p=new a(N(),{loop:n.options.loop,volume:n.options.volume,rate:n.options.playbackRate});p.addEventListener(s.CAN_PLAY,H);p.addEventListener(s.ENDED,U)}}function L(e){var t=R(e);var i=t.src;var r=t.mime;var a=new XMLHttpRequest;a.open("GET",i,true);a.responseType="arraybuffer";a.onload=function(e){var t=URL.createObjectURL(new Blob([e.target.response],{type:r}));O({src:t,mime:r})};a.onprogress=function(e){if(e.lengthComputable){var t=e.loaded/e.total;n.dispatchEvent(new o(s.PROGRESS,{perc:t}))}};a.send()}function j(){c.addEventListener("timeupdate",P);c.addEventListener("canplay",S);c.addEventListener("canplaythrough",S)}function C(){c.removeEventListener("timeupdate",P);c.removeEventListener("canplay",S);c.removeEventListener("canplaythrough",S)}function D(e){var t;if(Array.isArray(e)){t=document.createElement("video");for(var n=0;n<e.length;++n){if(typeof e[n]==="string"){t.appendChild(_(e[n]))}else{var i=e[n].mime?e[n].mime:e[n].type;t.appendChild(_(e[n].src,i))}}}else if(typeof e==="string"){t=document.createElement("video");t.appendChild(_(e))}else if(typeof e==="object"){t=document.createElement("video");var i=e.mime?e.mime:e.type;t.appendChild(_(e.src,i))}else{t=e}return t}function _(e,t){var n=document.createElement("source");n.src=e;var i=r.getExtension(e);if(i||t)n.type=t?t:"video/"+i;return n}function N(){var e;if(typeof t.audio==="boolean"){var n=c.querySelectorAll("source");for(var i=0;i<=n.length-1;i++){if(r.getAudioSupport(n[i].type)||r.getAudioSupport("video/"+r.getExtension(n[i].src))||!n[i].type){e=n[i].src;break}}}else if(typeof t.audio==="string"){e=t.audio}return e}function R(e){var t={};if(Array.isArray(e)){if(typeof e[0]==="string"){t.src=e[0]}else{var n=e[0].mime?e[0].mime:e[0].type;t.src=e[0].src;t.mime=n}}else if(typeof e==="string"){t.src=e}else if(typeof e==="object"){var n=e.mime?e.mime:e.type;t.src=e.src;t.mime=n}else{t=e}t.mime=t.mime?t.mime:"video/"+r.getExtension(t.src);return t}function S(e){if(!f){f=true;if(!n.options.audio){A()}else if(n.options.audio&&n.needTouchDevice){d=true;A()}else if(d){A()}}}function H(e){if(!d){d=true;if(f)A()}}function U(e){n.dispatchEvent(new o(s.ENDED));if(n.options.loop){v=true;p.currentTime=0;c.currentTime=0;m=p.currentTime}else{v=false;p.currentTime=0;c.currentTime=0;m=p.currentTime;p.pause()}}T(e,t)}u.prototype=Object.create(i.prototype);u.prototype.constructor=u;t.exports=u},{"../core/Utils":1,"../event/CanvasVideoEvent":2,"../event/Event":3,"../event/EventDispatcher":4,"./AudioPlayer":5}],7:[function(e,t,n){},{}]},{},[6])(6)});